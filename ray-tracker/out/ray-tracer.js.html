<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: ray-tracer.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: ray-tracer.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict"

/**
 * The main ray tracing routine
 */
async function main(){
    let canvas = document.querySelector("canvas");
    canvas.width = width * 2;
    canvas.height = height;
    let ctx = canvas.getContext("2d")

    let image = Array.from(Array(width), () => new Array(height))

    //Ray Tracer starts
    //Loop over all the pixels
    for (let y = 0; y &lt; height; y++){
        for (let x =0; x&lt; width; x++){
            if(!image[x][y]){
                image[x][y]=[]
            }
            let color = render(x,y)
            ctx.fillStyle = `rgb(${color.r}, ${color.g}, ${color.b})`
            ctx.fillRect(x, y, 1, 1)
        }
    }
}

/**
 * Run our ray tracer
 */
function render(x, y){


    //Determine the origin and direction of the ray
    let startX = x - width /2
    let startY = y - height /2
    let origin = Scene.scene.camera.getOrigin(startX, startY)
    let direction = Scene.scene.camera.getDirection(startX / (width /2), startY / (height /2))

    let result = closestCollision(origin, direction, null, 1)
    if (!result) return {r:128, g:128, b:128}
    // if (true) return {r:128, g:128, b:128}

    return {r:255, g:255, b:255}
}

function closestCollision(origin, direction, ignored = null, remaining = 1){
    if (remaining &lt;= 0) return;
    let closestPostiveT = Number.MAX_VALUE
    let closestCollision;

    //The color of the closest collision for this pixel
    for (let rayTracedObject of Scene.scene.rayTracedObjects){
        if (rayTracedObject == ignored) continue;
        //Get the geometry of the current object
        let geometry = rayTracedObject.geometry

        //Find the intersection with this object
        let collision = geometry.intersect(origin, direction);

        //Check to see if the collision exists...
        //...and if it is closer than any other collision we've seen
        if (collision &amp;&amp; collision.timeToCollision &lt; closestPostiveT){
            //Get the distance to collision
            closestPostiveT = collision.timeToCollision
            collision.rayTracedObject = rayTracedObject;

            closestCollision = collision

            //Get the location of the collision
            let c = collision.collisionLocation
            let normal = collision.normalAtCollision

            //Use the shader to calculate the color at this collision
            rayTracePixel = collision.rayTracedObject.shader.illuminateObject(origin, c, normal, rayTracedObject, remaining - 1)
        }
    }
    return closestCollision;
}

//Run the main ray tracer
main()</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#main">main</a></li><li><a href="global.html#render">render</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Thu Apr 18 2024 10:48:36 GMT-0500 (Central Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
